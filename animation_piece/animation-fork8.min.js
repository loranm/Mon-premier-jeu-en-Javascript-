
window.document.addEventListener('DOMContentLoaded',function(){var mySpriteSheet=new Image();mySpriteSheet.src='img/mySpriteSheet.png';var myBG=new Image();myBG.src='img/bg_4_02.jpg';var canvas=document.getElementById('coinAnimation');canvas.height=720;canvas.width=1000;var elements=[{img:myBG,sx:0,sy:0,sw:1000,sh:720,dx:0,dy:0,dw:1000,dh:720,scenery:true,},{sx:1100,sy:0,dx:800,dy:610,dw:100,dh:100,ratio:0.7,danger:true,scenery:true},{sx:1500,sy:0,dx:620,dy:575,dw:100,dh:100,scenery:true},{sx:0,sy:0,dx:500,dy:100,dw:100,dh:100,animation:true,numberOfFrames:9,ticksPerFrame:2},{sx:0,sy:800,dx:300,dy:600,dw:100,dh:100,moveFrom:1,moveTo:200,moving:true,numberOfFrames:7,ticksPerFrame:5},{sx:0,sy:800,dx:100,dy:650,dw:100,dh:100,ratio:0.5,moveFrom:10,moveTo:200,moving:true,numberOfFrames:7,ticksPerFrame:5},{sx:0,sy:800,dx:300,dy:640,dw:100,dh:100,ratio:0.5,moveFrom:1,moveTo:1000,moving:true,numberOfFrames:7,ticksPerFrame:5}];var danger=[];var bonus=[];var Sprite=function(options){this.context=options.context||canvas.getContext('2d');this.image=options.img||mySpriteSheet;this.sx=options.sx;this.sy=options.sy;this.sw=options.sw||100;this.sh=options.sh||100;this.dx=options.dx;this.dy=options.dy;this.dw=options.dw;this.dh=options.dh;this.ratio=options.ratio||1;this.frameIndex=0;this.scenery=options.scenery;this.danger=options.danger||false;this.render=function(){this.context.drawImage(this.image,this.sx+this.sw*this.frameIndex,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw*this.ratio,this.dh*this.ratio);};if(this.danger){danger.push(this);}
if(this.bonus){bonus.push(this);}};var AnimatedSprite=function(options){this.tickCount=0,this.ticksPerFrame=options.ticksPerFrame||0
this.numberOfFrames=options.numberOfFrames||1;this.animation=options.animation;this.update=function(){this.tickCount+=1;if(this.tickCount>this.ticksPerFrame){this.tickCount=0;if(this.frameIndex<this.numberOfFrames-1){this.frameIndex+=1;}else{this.frameIndex=0;};};};};var MovingSprite=function(options){this.moveTo=options.moveTo;this.moveFrom=options.moveFrom;this.moving=options.moving;this.startingSY=this.sy;this.move=function(){if(this.dx>this.moveTo){this.dir=1;this.sy=this.startingSY-100;}
if(this.dx<this.moveFrom){this.dir=0;this.sy=this.startingSY;}
if(this.dir){this.dx-=1;}else{this.dx+=1;}};}
var Heros=function(options){this.vx=5;this.vy=1;this.canRun=options.canRun;this.testCollision=function(){for(var i=0;i<danger.length;i++){if(this.dx<danger[i].dx+danger[i].dw&&this.dx+this.dw>danger[i].dx&&this.dy<danger[i].dy+danger[i].dh&&this.dh+this.dy>danger[i].dy){this.dx=10;}}};this.run=function(direction,animation){if(direction=='right'){this.sy=animation;this.numberOfFrames=27
this.dx+=5;this.testCollision();};if(direction=='left'){this.sy=animation;this.dx-=5;this.testCollision();};};};(function(){window.document.addEventListener('keydown',function(e){var event=e.keyCode;if(e.keyCode==38&&e.keyCode==39){alert('Deux touches')}
switch(event){case 39:if(tim.canRun){tim.canRun=false;tim.run('right',100);window.setTimeout(function(){tim.canRun=true;},25)}
break;case 37:if(tim.canRun){tim.canRun=false;tim.run('left',200);window.setTimeout(function(){tim.canRun=true;},25)}
break;case 38:if(tim.canRun){tim.canRun=false;tim.jump();window.setTimeout(function(){tim.canRun=true;},25)}
break;case 40:if(tim.canRun){tim.canRun=false;tim.fall();window.setTimeout(function(){tim.canRun=true;},25)}};window.document.addEventListener('keyup',function(e){tim.canRun=true;tim.numberOfFrames=22;tim.sy=400;});});})();var getSprite=function(options){return new Sprite(options);};var getAnimatedSprite=function(options){AnimatedSprite.prototype=getSprite(options);return new AnimatedSprite(options);};var getMovingSprite=function(options){MovingSprite.prototype=getAnimatedSprite(options);return new MovingSprite(options);};var getHeros=function(options){Heros.prototype=getAnimatedSprite(options);return new Heros(options);}
var stage=[];(function createStage(){for(var i=0;i<elements.length;i++){if(elements[i].scenery){stage[i]=getSprite(elements[i]);};if(elements[i].animation){stage[i]=getAnimatedSprite(elements[i]);};if(elements[i].moving){stage[i]=getMovingSprite(elements[i]);};}})();var displayStage=function(options){for(var i=0;i<options.length;i++){if(options[i].scenery){options[i].render();};if(options[i].animation){options[i].render();options[i].update();};if(options[i].moving){options[i].render();options[i].update();options[i].move();};};};function gameLoop(){canvas.getContext('2d').clearRect(0,0,canvas.width,canvas.height);displayStage(stage);window.requestAnimationFrame(gameLoop);};mySpriteSheet.addEventListener('load',gameLoop);var tim=getHeros({context:canvas.getContext('2d'),sx:0,sy:400,dx:100,dy:570,dw:100,dh:100,numberOfFrames:22,ticksPerFrame:2,canRun:true,});});